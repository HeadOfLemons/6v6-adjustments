#!mainFile "../../dev_main.opy"


rule "[wreckingball/init.opy]: Wrecking Ball":
    @Event eachPlayer
    @Condition eventPlayer.call_init
    @Condition eventPlayer.hero_setup == Hero.HAMMOND

    setCustomHp(
        ADJ_WRECKING_BALL_HEALTH_DUPLICATE if eventPlayer.isDuplicatingAHero() or SETTING_ECHO_TANK_HP else ADJ_WRECKING_BALL_HEALTH, 
        ADJ_WRECKING_BALL_ARMOR_DUPLICATE if eventPlayer.isDuplicatingAHero() or SETTING_ECHO_TANK_HP else ADJ_WRECKING_BALL_ARMOR, 
        0)
    removeTankPassive()
    removeSelfHealing()
    #eventPlayer.startScalingSize(0.9, true)
    #eventPlayer.setJumpVerticalSpeed(104)

    setBaseDamage(eventPlayer, ADJ_WRECKING_BALL_MINEFIELD_DAMAGE/OW2_WRECKING_BALL_MINEFIELD_DAMAGE)

    eventPlayer.call_init = false


rule "[wreckingball/init.opy]: Force Grappling Hook cooldown":
    @Event eachPlayer
    @Condition eventPlayer.hero_setup == Hero.HAMMOND
    @Condition eventPlayer.isFiringSecondaryFire() == true
    
    waitUntil(eventPlayer.getAbilityCooldown(Button.SECONDARY_FIRE) > 0.1, 999999986991104)
    eventPlayer.setAbilityCooldown(Button.SECONDARY_FIRE, 5)


rule "[wreckingball/init.opy]: Increase Piledriver damage":
    @Event playerDealtDamage
    @Condition eventPlayer.hero_setup == Hero.HAMMOND
    @Condition eventAbility == Button.CROUCH

    damage(
        victim, 
        attacker, 
        ((ADJ_WRECKING_BALL_PILEDRIVER_DAMAGE/OW2_WRECKING_BALL_PILEDRIVER_DAMAGE) \
        * (eventDamage/eventPlayer._base_damage_scalar) \
        - eventDamage)/eventPlayer._base_damage_scalar)


rule "[wreckingball/init.opy]: Increase Fireball impact damage":
    @Event playerDealtDamage
    @Condition eventPlayer.hero_setup == Hero.HAMMOND
    @Condition eventAbility == Button.SECONDARY_FIRE
        
        damage(
            victim, 
            attacker, 
            ((ADJ_WRECKING_BALL_FIREBALL_DAMAGE/OW2_WRECKING_BALL_FIREBALL_DAMAGE) \
            * (eventDamage/eventPlayer._base_damage_scalar) \
            - eventDamage)/eventPlayer._base_damage_scalar)


rule "[wreckingball/init.opy]: Increase Quad Cannons and Melee damage":
        @Event eachPlayer
        @Condition eventPlayer.hero_setup == Hero.HAMMOND
        @Condition eventPlayer.isUsingAbility1()
            
        eventPlayer.setDamageDealt(percent(ADJ_WRECKING_BALL_MINEFIELD_DAMAGE/OW2_WRECKING_BALL_MINEFIELD_DAMAGE))
        waitUntil(not eventPlayer.isUsingAbility1(), 99999)
        eventPlayer.setDamageDealt(100)

/*
rule "Correct Adaptive Shields overhealth while outside spawn rooms":
    @Event eachPlayer
    @Condition eventPlayer.hero_setup == Hero.HAMMOND
    @Condition eventPlayer.isUsingAbility2() == true
    @Condition eventPlayer.isInSpawnRoom() == false
    @Condition eventPlayer.overhealth_check == false
    
    damage(eventPlayer, null, 100)
    eventPlayer.overhealth_check = true
    waitUntil(eventPlayer.isUsingAbility2() == false, 99999)
    eventPlayer.overhealth_check = false
*/

/*
rule "Correct Adaptive Shields overhealth while inside spawn rooms":
    @Event eachPlayer
    @Condition eventPlayer.hero_setup == Hero.HAMMOND
    @Condition eventPlayer.isUsingAbility2() == true
    @Condition eventPlayer.isInSpawnRoom() == true
    @Condition eventPlayer.overhealth_check == false
    
    eventPlayer.setHealth(eventPlayer.getMaxHealth() - 100)
    eventPlayer.overhealth_check = true
    waitUntil(eventPlayer.isUsingAbility2() == false, 99999)
    eventPlayer.overhealth_check = false
*/

/*
rule "Enable Adaptive Shields when near enemy players":
    @Event eachPlayer
    @Condition eventPlayer.hero_setup == Hero.HAMMOND
    @Condition getPlayersInRadius(eventPlayer, 8.9, getOppositeTeam(eventPlayer.getTeam()), LosCheck.OFF) >= 1
    
    eventPlayer.setAbility2Enabled(true)
*/

/*
rule "Disable Adaptive Shields when not near enemy players":
    @Event eachPlayer
    @Condition eventPlayer.hero_setup == Hero.HAMMOND
    @Condition getPlayersInRadius(eventPlayer, 8.9, getOppositeTeam(eventPlayer.getTeam()), LosCheck.OFF) <= 0
    
    eventPlayer.setAbility2Enabled(false)
*/

rule "[wreckingball/init.opy]: Remove Adaptive Shields overhealth transfer":
    @Event eachPlayer
    @Condition eventPlayer.hero_setup == Hero.HAMMOND
    @Condition eventPlayer.isUsingAbility2()
    
    eventPlayer.disallowButton(Button.ABILITY_2)
    eventPlayer.setAbility2Enabled(false)
    waitUntil(not eventPlayer.isUsingAbility2(), Math.INFINITY)
    enableAllAbilities()
    eventPlayer.allowButton(Button.ABILITY_2)


/*
rule "(Duplicate) pile cooldown":
*/